<div *ngIf="isLoading" class="d-flex justify-content-center">
  <div class="spinner-border" role="status">
    <span class="sr-only">Loading...</span>
  </div>
</div>

<div *ngIf="!isLoading" class="col-sm">
  <div class="row">
    <div class="col-md-3">
      <h2>Equipment</h2>
    </div>
    <div class="col-md-3">
      <button class="btn-sm" (click)="update()">reload equipment</button>&nbsp;
      <button class="btn-sm" (click)="isExpanded = !isExpanded">toggle open</button>
    </div>
    <div class="form-group col-md-3 form-inline">
      {{ totalSelected() }} out of 20 max items selected
      <!--<label for="showFields">Columns&nbsp;</label>
      <select id="showFields" class="form-control form-control-sm">
        <option selected>Choose...</option>
        <option>da Fence</option>
      </select>-->
    </div>
  </div>
  <mat-accordion multi>
    <mat-expansion-panel *ngFor="let slot of slots; let i = index" [expanded]="isExpanded">
      <mat-expansion-panel-header>
        <mat-panel-title>{{slotNames[i]}}</mat-panel-title>
        <mat-panel-description>
          {{(equipment$ | async)[slot]?.length}} items
          ({{ numberSelected(slot) }}) selected
        </mat-panel-description>
      </mat-expansion-panel-header>
      <table class="table" mat-table [dataSource]="getDataSource(slot)" matSort>

        <!-- ID Column -->
        <ng-container matColumnDef="selected">
          <th mat-header-cell *matHeaderCellDef class="text-center">
            <input type="checkbox" [value]="true" (click)="toggleSelectAll(slot)" [checked]="isAllChecked(slot)" />
          </th>
          <td mat-cell *matCellDef="let item" class="text-center">
            <input type="checkbox" [value]="true" (click)="toggleItem(slot, item)" [checked]="isSelected(slot, item)" />
          </td>
        </ng-container>

        <!-- Name Column -->
        <ng-container matColumnDef="Name">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
          <td mat-cell *matCellDef="let item">{{ item.Name }} </td>
        </ng-container>

        <!-- Armor Column -->
        <ng-container matColumnDef="Armor">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Armor</th>
          <td mat-cell *matCellDef="let item">{{ item.Armor }} </td>
        </ng-container>

        <!-- Armor Percent Column -->
        <ng-container matColumnDef="Armor Percent">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Armor Percent</th>
          <td mat-cell *matCellDef="let item">{{ item['Armor Percent']}} </td>
        </ng-container>

        <!-- Toughness Column -->
        <ng-container matColumnDef="Toughness">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Toughness</th>
          <td mat-cell *matCellDef="let item">{{ item.Toughness }} </td>
        </ng-container>

        <!-- Toughness Percent Column -->
        <ng-container matColumnDef="Toughness Percent">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Toughness Percent</th>
          <td mat-cell *matCellDef="let item">{{ item['Toughness Percent']}} </td>
        </ng-container>

        <!-- Protection Column -->
        <ng-container matColumnDef="Protection">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Protection</th>
          <td mat-cell *matCellDef="let item">{{ item.Protection }} </td>
        </ng-container>

        <!-- Evasion Column -->
        <ng-container matColumnDef="Evasion">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Evasion</th>
          <td mat-cell *matCellDef="let item">{{ item.Evasion }} </td>
        </ng-container>

        <!-- Regeneration Column -->
        <ng-container matColumnDef="Regeneration">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Regeneration</th>
          <td mat-cell *matCellDef="let item">{{ item.Regeneration }} </td>
        </ng-container>

        <!-- Life Drain Column -->
        <ng-container matColumnDef="Life Drain">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Life Drain</th>
          <td mat-cell *matCellDef="let item">{{ item['Life Drain'] }} </td>
        </ng-container>

        <!-- Health Column -->
        <ng-container matColumnDef="Health">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Health</th>
          <td mat-cell *matCellDef="let item">{{ item.Health }} </td>
        </ng-container>

        <!-- Health Percent Column -->
        <ng-container matColumnDef="Health Percent">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Health Percent</th>
          <td mat-cell *matCellDef="let item">{{ item['Health Percent']}} </td>
        </ng-container>

        <!-- Attack Speed Column -->
        <ng-container matColumnDef="Attack Speed">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Attack Speed</th>
          <td mat-cell *matCellDef="let item">{{ item['Attack Speed'] }} </td>
        </ng-container>

        <!-- Attack Speed Percent Column -->
        <ng-container matColumnDef="Attack Speed Percent">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Attack Speed Percent</th>
          <td mat-cell *matCellDef="let item">{{ item['Attack Speed Percent']}} </td>
        </ng-container>

        <!-- Type Column -->
        <ng-container matColumnDef="Type">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Type</th>
          <td mat-cell *matCellDef="let item">{{ item.Type }} </td>
        </ng-container>

        <!-- Place Column -->
        <ng-container matColumnDef="Place">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Place</th>
          <td mat-cell *matCellDef="let item">{{ item.Place }} </td>
        </ng-container>

        <!-- Tier Column -->
        <ng-container matColumnDef="Tier">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Tier</th>
          <td mat-cell *matCellDef="let item">{{ item.Tier }} </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      </table>
    </mat-expansion-panel>
  </mat-accordion>
</div>
